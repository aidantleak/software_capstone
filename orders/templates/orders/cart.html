{% extends 'orders/base.html' %}

{% load static %}

{% block title %}Your Cart - Triton Pub{% endblock %}

{% block content %}
<div class="banner">
    <h1>Your Cart</h1>
</div>

<div class="cart-container">
    {% if cart %}
        {% for item in cart %}
            <div class="cart-item">
                {% if item.image %}
                    <img src="{{ item.image }}" alt="{{ item.name }}">
                {% endif %}
                <p><strong>{{ item.name }}</strong></p>
                <p>Side: {{ item.side }}</p>
                <p>Quantity: {{ item.quantity }}</p>
                <p>Price: ${{ item.price }}</p>
                {% if item.special_request %}
                    <p><strong>Request:</strong> {{ item.special_request }}</p>
                {% endif %}
            </div>
        {% endfor %}

        <form method="post" action="{% url 'place_order' %}">
            {% csrf_token %}
            <div class="form-section">
                <label for="payment_method">Payment Method</label>
                <select name="payment_method" required>
                    <option value="">Select</option>
                    <option value="meal_swipe">Meal Swipe</option>
                    <option value="flex_dollars">Flex Dollars</option>
                </select>

                <label for="delivery_method">Delivery Method</label>
                <select name="delivery_method" id="delivery_method" onchange="toggleDormField()" required>
                    <option value="">Select</option>
                    <option value="pickup">Pickup</option>
                    <option value="dorm">Dorm Delivery</option>
                </select>

                <div id="dormEntry" style="display:none;">
                    <label for="dorm">Enter Dorm Room/Location</label>
                    <input type="text" name="dorm" value="{{ user.userprofile.dorm_location }}" placeholder="e.g. Triton Hall 204">
                </div>

                <label for="phone">Phone Number</label>
                <input type="text" name="phone" value="{{ user.userprofile.phone_number }}" placeholder="e.g. 123-456-7890">
            </div>

            <button type="submit" class="button">Place Order</button>
        </form>
    {% else %}
        <p>Your cart is empty.</p>
    {% endif %}
</div>

<script>
    function toggleDormField() {
        const delivery = document.getElementById("delivery_method");
        const dormField = document.getElementById("dormEntry");
        dormField.style.display = delivery.value === "dorm" ? "block" : "none";
    }
</script>
{% endblock %}
