{% extends 'orders/base.html' %}
{% load static %}

{% block content %}
<h2 style="text-align:center; margin-top: 20px;">Triton Service - Order Management</h2>
<div style="max-width: 1000px; margin: auto; padding: 20px;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #0b1a3d; color: white;">
                <th style="padding: 10px;">Order ID</th>
                <th>User</th>
                <th>Dorm</th>
                <th>Phone</th>
                <th>Details</th>
                <th>Payment</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for order in all_orders %}
            <tr style="border-bottom: 1px solid #ccc;">
                <td style="padding: 10px;">{{ order.id }}</td>
                <td>{{ order.user.username }}</td>
                <td>{{ order.user.userprofile.dorm_location }}</td>
                <td>{{ order.user.userprofile.phone_number }}</td>
                <td>
                    <ul>
                        {% for item in order.items.all %}
                        <li><strong>{{ item.meal.name }}</strong> ({{ item.side }}, Qty: {{ item.quantity }})<br>{{ item.special_request }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>{{ order.payment_method|title }}<br>${{ order.total_cost }}</td>
                <td>{{ order.status }}</td>
                <td>
                    <form method="post" action="{% url 'update_order_status' order.id %}">
                        {% csrf_token %}
                        <select name="status" style="margin-bottom: 5px;">
                            <option value="in_progress" {% if order.status == "in_progress" %} selected {% endif %}>In Progress</option>
                            <option value="ready_for_pickup" {% if order.status == "ready_for_pickup" %} selected {% endif %}>Ready for Pickup</option>
                            {% if order.delivery_method == 'delivery' %}
                            <option value="on_the_way" {% if order.status == "on_the_way" %} selected {% endif %}>On the Way</option>
                            <option value="delivered" {% if order.status == "delivered" %} selected {% endif %}>Delivered</option>
                            {% endif %}
                            <option value="canceled" {% if order.status == "canceled" %} selected {% endif %}>Canceled</option>
                        </select><br>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}